# ==========================================
# APPLICATION CONFIGURATION
# ==========================================
spring.application.name=apigateway
server.port=${PORT:8080}

# ==========================================
# EUREKA CLIENT CONFIGURATION
# ==========================================
eureka.client.service-url.defaultZone=${EUREKA_SERVER_URL:https://servereurekacc.onrender.com/eureka/}
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

# Instance configuration for Render
eureka.instance.prefer-ip-address=false
eureka.instance.hostname=${RENDER_EXTERNAL_HOSTNAME:localhost}
eureka.instance.non-secure-port-enabled=false
eureka.instance.secure-port-enabled=true
eureka.instance.secure-port=443
eureka.instance.home-page-url=https://${eureka.instance.hostname}/
eureka.instance.status-page-url=https://${eureka.instance.hostname}/actuator/info
eureka.instance.health-check-url=https://${eureka.instance.hostname}/actuator/health
eureka.instance.instance-id=${spring.application.name}:${random.value}

# Timeouts y reintentos
eureka.client.registry-fetch-interval-seconds=30
eureka.client.instance-info-replication-interval-seconds=30
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90

# ==========================================
# GATEWAY ROUTES CONFIGURATION
# ==========================================

# ===== USERSAPI ROUTES =====
# Auth endpoints
spring.cloud.gateway.routes[0].id=users-auth
spring.cloud.gateway.routes[0].uri=${USERSAPI_URL:https://usersapi-d1p8.onrender.com}
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/v1/auth/**

# Profile endpoints
spring.cloud.gateway.routes[1].id=users-profile
spring.cloud.gateway.routes[1].uri=${USERSAPI_URL:https://usersapi-d1p8.onrender.com}
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/v1/profile/**

# Skills endpoints
spring.cloud.gateway.routes[2].id=users-skills
spring.cloud.gateway.routes[2].uri=${USERSAPI_URL:https://usersapi-d1p8.onrender.com}
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/v1/skills/**

# Academic endpoints
spring.cloud.gateway.routes[3].id=users-academic
spring.cloud.gateway.routes[3].uri=${USERSAPI_URL:https://usersapi-d1p8.onrender.com}
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/v1/academic/**

# Work experience endpoints
spring.cloud.gateway.routes[4].id=users-work
spring.cloud.gateway.routes[4].uri=${USERSAPI_URL:https://usersapi-d1p8.onrender.com}
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/v1/work-experience/**

# UsersAPI Swagger
spring.cloud.gateway.routes[5].id=users-swagger
spring.cloud.gateway.routes[5].uri=${USERSAPI_URL:https://usersapi-d1p8.onrender.com}
spring.cloud.gateway.routes[5].predicates[0]=Path=/users/swagger-ui/**
spring.cloud.gateway.routes[5].filters[0]=StripPrefix=1

spring.cloud.gateway.routes[6].id=users-api-docs
spring.cloud.gateway.routes[6].uri=${USERSAPI_URL:https://usersapi-d1p8.onrender.com}
spring.cloud.gateway.routes[6].predicates[0]=Path=/users/v3/api-docs/**
spring.cloud.gateway.routes[6].filters[0]=StripPrefix=1

# ===== EVALUATIONSAPI ROUTES =====
# Evaluations endpoints
spring.cloud.gateway.routes[7].id=evaluations-evaluations
spring.cloud.gateway.routes[7].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[7].predicates[0]=Path=/api/v1/evaluations/**

# Careers endpoints
spring.cloud.gateway.routes[8].id=evaluations-careers
spring.cloud.gateway.routes[8].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[8].predicates[0]=Path=/api/v1/careers/**

# Specializations endpoints
spring.cloud.gateway.routes[9].id=evaluations-specializations
spring.cloud.gateway.routes[9].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[9].predicates[0]=Path=/api/v1/specializations/**

# Favorite careers endpoints
spring.cloud.gateway.routes[10].id=evaluations-favorite-careers
spring.cloud.gateway.routes[10].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[10].predicates[0]=Path=/api/v1/favorite-careers/**

# Favorite specializations endpoints
spring.cloud.gateway.routes[11].id=evaluations-favorite-specializations
spring.cloud.gateway.routes[11].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[11].predicates[0]=Path=/api/v1/favorite-specializations/**

# Tests endpoints
spring.cloud.gateway.routes[12].id=evaluations-tests
spring.cloud.gateway.routes[12].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[12].predicates[0]=Path=/api/v1/tests/**

# EvaluationsAPI Swagger
spring.cloud.gateway.routes[13].id=evaluations-swagger
spring.cloud.gateway.routes[13].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[13].predicates[0]=Path=/evaluations/swagger-ui/**
spring.cloud.gateway.routes[13].filters[0]=StripPrefix=1

spring.cloud.gateway.routes[14].id=evaluations-api-docs
spring.cloud.gateway.routes[14].uri=${EVALUATIONSAPI_URL:https://evaluationsapi.onrender.com}
spring.cloud.gateway.routes[14].predicates[0]=Path=/evaluations/v3/api-docs/**
spring.cloud.gateway.routes[14].filters[0]=StripPrefix=1

# ===== GRAPHQL ROUTES =====
# GraphQL endpoint
spring.cloud.gateway.routes[15].id=graphql-endpoint
spring.cloud.gateway.routes[15].uri=${GRAPHQL_URL:https://graphqlservice-1.onrender.com}
spring.cloud.gateway.routes[15].predicates[0]=Path=/graphql

# GraphiQL UI
spring.cloud.gateway.routes[16].id=graphql-ui
spring.cloud.gateway.routes[16].uri=${GRAPHQL_URL:https://graphqlservice-1.onrender.com}
spring.cloud.gateway.routes[16].predicates[0]=Path=/graphiql/**

# ==========================================
# ACTUATOR ENDPOINTS
# ==========================================
management.endpoints.web.exposure.include=health,info,gateway
management.endpoint.health.show-details=always

# ==========================================
# LOGGING CONFIGURATION
# ==========================================
logging.level.root=INFO
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.compass.career.apigateway=DEBUG